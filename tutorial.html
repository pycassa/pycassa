

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; pycassa v1.0.3 documentation</title>
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="pycassa v1.0.3 documentation" href="index.html" />
    <link rel="next" title="pycassaShell" href="pycassa_shell.html" />
    <link rel="prev" title="Installing" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pycassa_shell.html" title="pycassaShell"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installing"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pycassa v1.0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial is intended as an introduction to working with
Cassandra and <strong>pycassa</strong>.</p>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before we start, make sure that you have <strong>pycassa</strong>
<a class="reference internal" href="installation.html"><em>installed</em></a>. In the Python shell, the following
should run without raising an exception:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pycassa</span>
</pre></div>
</div>
<p>This tutorial also assumes that a Cassandra instance is running on the
default host and port. Read the <a class="reference external" href="http://wiki.apache.org/cassandra/GettingStarted">instructions for getting started
with Cassandra</a> ,
making sure that you choose a <a class="reference external" href="http://wiki.github.com/pycassa/pycassa/pycassa-cassandra-compatibility">version that is compatible with
pycassa</a>.
You can start Cassandra like so:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">pwd</span>
~/cassandra
<span class="nv">$ </span>bin/cassandra -f
</pre></div>
</div>
<p>and import the included schema to start out:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>bin/schematool localhost 8080 import
</pre></div>
</div>
</div>
<div class="section" id="connecting-to-cassandra">
<h2>Connecting to Cassandra<a class="headerlink" href="#connecting-to-cassandra" title="Permalink to this headline">¶</a></h2>
<p>The first step when working with <strong>pycassa</strong> is to connect to the
running cassandra instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pycassa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;Keyspace1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code will connect by default to &#8216;localhost:9160&#8217;. We can
also specify the host and port explicitly, as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;Keyspace1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;localhost:9160&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>This creates a small connection pool for use with
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily" title="pycassa.columnfamily.ColumnFamily"><tt class="xref py py-class docutils literal"><span class="pre">ColumnFamily</span></tt></a> . See <a class="reference internal" href="#connection-pooling">Connection Pooling</a>
for more details.</p>
</div>
<div class="section" id="getting-a-columnfamily">
<h2>Getting a ColumnFamily<a class="headerlink" href="#getting-a-columnfamily" title="Permalink to this headline">¶</a></h2>
<p>A column family is a collection of rows and columns in Cassandra,
and can be thought of as roughly the equivalent of a table in a
relational database. We&#8217;ll use one of the column families that
are included in the default schema file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;Keyspace1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Standard1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you get an error about the keyspace or column family not
existing, make sure you imported the schema with <tt class="file docutils literal"><span class="pre">bin/schematool</span></tt>.</p>
</div>
<div class="section" id="inserting-data">
<h2>Inserting Data<a class="headerlink" href="#inserting-data" title="Permalink to this headline">¶</a></h2>
<p>To insert a row into a column family we can use the
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.insert" title="pycassa.columnfamily.ColumnFamily.insert"><tt class="xref py py-meth docutils literal"><span class="pre">insert()</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;col_name&#39;</span><span class="p">:</span> <span class="s">&#39;col_val&#39;</span><span class="p">})</span>
<span class="go">1354459123410932</span>
</pre></div>
</div>
<p>We can also insert more than one column at a time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name1&#39;</span><span class="p">:</span><span class="s">&#39;val1&#39;</span><span class="p">,</span> <span class="s">&#39;name2&#39;</span><span class="p">:</span><span class="s">&#39;val2&#39;</span><span class="p">})</span>
<span class="go">1354459123410932</span>
</pre></div>
</div>
<p>And we can insert more than one row at a time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">batch_insert</span><span class="p">({</span><span class="s">&#39;row1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;name1&#39;</span><span class="p">:</span><span class="s">&#39;val1&#39;</span><span class="p">,</span> <span class="s">&#39;name2&#39;</span><span class="p">:</span><span class="s">&#39;val2&#39;</span><span class="p">},</span>
<span class="gp">... </span>                      <span class="s">&#39;row2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span><span class="s">&#39;bar&#39;</span><span class="p">})</span>
<span class="go">1354491238721387</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-data">
<h2>Getting Data<a class="headerlink" href="#getting-data" title="Permalink to this headline">¶</a></h2>
<p>There are many more ways to get data out of Cassandra than there are
to insert data.</p>
<p>The simplest way to get data is to use
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.get" title="pycassa.columnfamily.ColumnFamily.get"><tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">)</span>
<span class="go">{&#39;colname&#39;: &#39;col_val&#39;}</span>
</pre></div>
</div>
<p>Without any other arguments, <a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.get" title="pycassa.columnfamily.ColumnFamily.get"><tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt></a>
returns every column in the row (up to <cite>column_count</cite>, which defaults to 100).
If you only want a few of the columns and you know them by name, you can
specify them using a <cite>columns</cite> argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;name1&#39;</span><span class="p">,</span> <span class="s">&#39;name2&#39;</span><span class="p">])</span>
<span class="go">{&#39;name1&#39;: &#39;foo&#39;, &#39;name2&#39;: &#39;bar&#39;}</span>
</pre></div>
</div>
<p>We may also get a slice (or subrange) of the columns in a row. To do this,
use the <cite>column_start</cite> and <cite>column_finish</cite> parameters.  One or both of these may
be left empty to allow the slice to extend to one or both ends.
Note that <cite>column_finish</cite> is inclusive. Assuming we&#8217;ve inserted several
columns with names &#8216;1&#8217; through &#8216;9&#8217;, we can do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="n">column_start</span><span class="o">=</span><span class="s">&#39;5&#39;</span><span class="p">,</span> <span class="n">column_finish</span><span class="o">=</span><span class="s">&#39;7&#39;</span><span class="p">)</span>
<span class="go">{&#39;5&#39;:&#39;foo&#39;, &#39;6&#39;:&#39;bar&#39;, &#39;7&#39;:&#39;baz&#39;}</span>
</pre></div>
</div>
<p>Sometimes you want to get columns in reverse sorted order.  A common
example of this is getting the last N columns from a row that
represents a timeline.  To do this, set <cite>column_reversed</cite> to <tt class="xref docutils literal"><span class="pre">True</span></tt>.
If you think of the columns as being sorted from left to right, when
<cite>column_reversed</cite> is <tt class="xref docutils literal"><span class="pre">True</span></tt>, <cite>column_start</cite> will determine the right
end of the range while <cite>column_finish</cite> will determine the left.</p>
<p>Here&#8217;s an example of getting the last three columns in a row:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">col_fam</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="s">&#39;val&#39;</span><span class="p">}</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="n">column_reversed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">column_count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">{20: &#39;val&#39;, 19: &#39;val&#39;, 18: &#39;val&#39;}</span>
</pre></div>
</div>
<p>There are a few ways to get multiple rows at the same time.
The first is to specify them by name using
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.multiget" title="pycassa.columnfamily.ColumnFamily.multiget"><tt class="xref py py-meth docutils literal"><span class="pre">multiget()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">multiget</span><span class="p">([</span><span class="s">&#39;row_key1&#39;</span><span class="p">,</span> <span class="s">&#39;row_key2&#39;</span><span class="p">])</span>
<span class="go">{&#39;row_key1&#39;: {&#39;name&#39;:&#39;val&#39;}, &#39;row_key2&#39;: {&#39;name&#39;:&#39;val&#39;}}</span>
</pre></div>
</div>
<p>Another way is to get a range of keys at once by using
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.get_range" title="pycassa.columnfamily.ColumnFamily.get_range"><tt class="xref py py-meth docutils literal"><span class="pre">get_range()</span></tt></a>. The parameter
<cite>finish</cite> is also inclusive here, too.  Assuming we&#8217;ve inserted some rows
with keys &#8216;row_key1&#8217; through &#8216;row_key9&#8217;, we can do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">col_fam</span><span class="o">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s">&#39;row_key5&#39;</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="s">&#39;row_key7&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">columns</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="s">&#39;=&gt;&#39;</span><span class="p">,</span> <span class="n">columns</span>
<span class="gp">...</span>
<span class="go">&#39;row_key5&#39; =&gt; {&#39;name&#39;:&#39;val&#39;}</span>
<span class="go">&#39;row_key6&#39; =&gt; {&#39;name&#39;:&#39;val&#39;}</span>
<span class="go">&#39;row_key7&#39; =&gt; {&#39;name&#39;:&#39;val&#39;}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cassandra must be using an OrderPreservingPartitioner for you to be
able to get a meaningful range of rows; the default, RandomPartitioner,
stores rows in the order of the MD5 hash of their keys. See
<a class="reference external" href="http://www.riptano.com/docs/0.6/operations/clustering#partitioners">http://www.riptano.com/docs/0.6/operations/clustering#partitioners</a>.</p>
</div>
<p>The last way to get multiple rows at a time is to take advantage of
secondary indexes by using <a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.get_indexed_slices" title="pycassa.columnfamily.ColumnFamily.get_indexed_slices"><tt class="xref py py-meth docutils literal"><span class="pre">get_indexed_slices()</span></tt></a>,
which is described in the <a class="reference internal" href="#indexes">Indexes</a> section.</p>
<p>It&#8217;s also possible to specify a set of columns or a slice for
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.multiget" title="pycassa.columnfamily.ColumnFamily.multiget"><tt class="xref py py-meth docutils literal"><span class="pre">multiget()</span></tt></a> and
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.get_range" title="pycassa.columnfamily.ColumnFamily.get_range"><tt class="xref py py-meth docutils literal"><span class="pre">get_range()</span></tt></a> just like we did for
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.get" title="pycassa.columnfamily.ColumnFamily.get"><tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt></a>.</p>
</div>
<div class="section" id="counting">
<h2>Counting<a class="headerlink" href="#counting" title="Permalink to this headline">¶</a></h2>
<p>If you just want to know how many columns are in a row, you can use
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.get_count" title="pycassa.columnfamily.ColumnFamily.get_count"><tt class="xref py py-meth docutils literal"><span class="pre">get_count()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get_count</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
<p>If you only want to get a count of the number of columns that are inside
of a slice or have particular names, you can do that as well:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get_count</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">])</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get_count</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="n">column_start</span><span class="o">=</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
<span class="go">3</span>
</pre></div>
</div>
<p>You can also do this in parallel for multiple rows using
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.multiget_count" title="pycassa.columnfamily.ColumnFamily.multiget_count"><tt class="xref py py-meth docutils literal"><span class="pre">multiget_count()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">multiget_count</span><span class="p">([</span><span class="s">&#39;fib0&#39;</span><span class="p">,</span> <span class="s">&#39;fib1&#39;</span><span class="p">,</span> <span class="s">&#39;fib2&#39;</span><span class="p">,</span> <span class="s">&#39;fib3&#39;</span><span class="p">,</span> <span class="s">&#39;fib4&#39;</span><span class="p">])</span>
<span class="go">{&#39;fib0&#39;: 1, &#39;fib1&#39;: 1, &#39;fib2&#39;: 2, &#39;fib3&#39;: 3, &#39;fib4&#39;: 5&#39;}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">multiget_count</span><span class="p">([</span><span class="s">&#39;fib0&#39;</span><span class="p">,</span> <span class="s">&#39;fib1&#39;</span><span class="p">,</span> <span class="s">&#39;fib2&#39;</span><span class="p">,</span> <span class="s">&#39;fib3&#39;</span><span class="p">,</span> <span class="s">&#39;fib4&#39;</span><span class="p">],</span>
<span class="gp">... </span>                       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;col1&#39;</span><span class="p">,</span> <span class="s">&#39;col2&#39;</span><span class="p">,</span> <span class="s">&#39;col3&#39;</span><span class="p">])</span>
<span class="go">{&#39;fib0&#39;: 1, &#39;fib1&#39;: 1, &#39;fib2&#39;: 2, &#39;fib3&#39;: 3, &#39;fib4&#39;: 3&#39;}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">multiget_count</span><span class="p">([</span><span class="s">&#39;fib0&#39;</span><span class="p">,</span> <span class="s">&#39;fib1&#39;</span><span class="p">,</span> <span class="s">&#39;fib2&#39;</span><span class="p">,</span> <span class="s">&#39;fib3&#39;</span><span class="p">,</span> <span class="s">&#39;fib4&#39;</span><span class="p">],</span>
<span class="gp">... </span>                       <span class="n">column_start</span><span class="o">=</span><span class="s">&#39;col1&#39;</span><span class="p">,</span> <span class="n">column_finish</span><span class="o">=</span><span class="s">&#39;col3&#39;</span><span class="p">)</span>
<span class="go">{&#39;fib0&#39;: 1, &#39;fib1&#39;: 1, &#39;fib2&#39;: 2, &#39;fib3&#39;: 3, &#39;fib4&#39;: 3&#39;}</span>
</pre></div>
</div>
</div>
<div class="section" id="super-columns">
<h2>Super Columns<a class="headerlink" href="#super-columns" title="Permalink to this headline">¶</a></h2>
<p>Cassandra allows you to group columns in &#8220;super columns&#8221;. In a
<tt class="docutils literal"><span class="pre">cassandra.yaml</span></tt> file, this looks like this:</p>
<div class="highlight-python"><pre>- name: Super1
  column_type: Super</pre>
</div>
<p>To use a super column in <strong>pycassa</strong>, you only need to
add an extra level to the dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Super1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;supercol_name&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;col_name&#39;</span><span class="p">:</span> <span class="s">&#39;col_val&#39;</span><span class="p">}})</span>
<span class="go">1354491238721345</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">)</span>
<span class="go">{&#39;supercol_name&#39;: {&#39;col_name&#39;: &#39;col_val&#39;}}</span>
</pre></div>
</div>
<p>The <cite>supercolumn</cite> parameter for <tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt>-like methods allows
you to be selective about what subcolumns you get from a single
supercolumn.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Letters&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;lowercase&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}})</span>
<span class="go">1354491239132744</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="n">supercolumn</span><span class="o">=</span><span class="s">&#39;lowercase&#39;</span><span class="p">)</span>
<span class="go">{&#39;supercol1&#39;: {&#39;a&#39;: 1: &#39;b&#39;: 2, &#39;c&#39;: 3}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="n">supercolumn</span><span class="o">=</span><span class="s">&#39;lowercase&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">])</span>
<span class="go">{&#39;supercol1&#39;: {&#39;a&#39;: 1: &#39;b&#39;: 2}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="n">supercolumn</span><span class="o">=</span><span class="s">&#39;lowercase&#39;</span><span class="p">,</span> <span class="n">column_start</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
<span class="go">{&#39;supercol1&#39;: {&#39;b&#39;: 1: &#39;c&#39;: 2}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="n">supercolumn</span><span class="o">=</span><span class="s">&#39;lowercase&#39;</span><span class="p">,</span> <span class="n">column_finish</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">column_reversed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">{&#39;supercol1&#39;: {&#39;c&#39;: 2, &#39;b&#39;: 1}}</span>
</pre></div>
</div>
</div>
<div class="section" id="typed-column-names-and-values">
<h2>Typed Column Names and Values<a class="headerlink" href="#typed-column-names-and-values" title="Permalink to this headline">¶</a></h2>
<p>In Cassandra 0.7, you can specify a comparator type for column names
and a validator type for column values.</p>
<p>The types available are:</p>
<ul class="simple">
<li>BytesType - no type</li>
<li>IntegerType - 32 bit integer</li>
<li>LongType - 64 bit integer</li>
<li>AsciiType - ASCII string</li>
<li>UTF8Type - UTF8 encoded string</li>
<li>TimeUUIDType - version 1 UUID (timestamp based)</li>
<li>LexicalUUID - non-version 1 UUID</li>
</ul>
<p>The column name comparator types affect how columns are sorted within
a row. You can use these with standard column families as well as with
super column families; with super column families, the subcolumns may
even have a different comparator type.  Here&#8217;s an example <tt class="docutils literal"><span class="pre">cassandra.yaml</span></tt>:</p>
<div class="highlight-python"><pre>- name: StandardInt
  column_type: Standard
  compare_with: IntegerType

- name: SuperLongSubAscii
  column_type: Super
  compare_with: LongType
  compare_subcolumns_with: AsciiType</pre>
</div>
<p>Cassandra still requires you to pack these types into a format it can
understand by using something like <tt class="xref py py-meth docutils literal"><span class="pre">struct.pack()</span></tt>.  Fortunately,
when <strong>pycassa</strong> sees that a column family uses these types, it knows
to pack and unpack these data types automatically for you. So, if we want to
write to the StandardInt column family, we can do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;StandardInt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="p">{</span><span class="mi">42</span><span class="p">:</span> <span class="s">&#39;some_val&#39;</span><span class="p">})</span>
<span class="go">1354491238721387</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">)</span>
<span class="go">{42: &#39;some_val&#39;}</span>
</pre></div>
</div>
<p>Notice that 42 is an integer here, not a string.</p>
<p>As mentioned above, Cassandra also offers validators on column values with
the same set of types.  Validators can be set for an entire column family,
for individual columns, or both.  Here&#8217;s another example <tt class="docutils literal"><span class="pre">cassandra.yaml</span></tt>:</p>
<div class="highlight-python"><pre>- name: AllLongs
  column_type: Standard
  default_validation_class: LongType

- name: OneUUID
  column_type: Standard
  column_metadata:
    - name: uuid
      validator_class: TimeUUIDType

- name: LongsExceptUUID
  column_type: Standard
  default_validation_class: LongType
  column_metadata:
    - name: uuid
      validator_class: TimeUUIDType</pre>
</div>
<p><strong>pycassa</strong> knows to pack these column values automatically too:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">uuid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;LongsExceptUUID&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;foo&#39;</span><span class="p">:</span> <span class="mi">123456789</span><span class="p">,</span> <span class="s">&#39;uuid&#39;</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">()})</span>
<span class="go">1354491238782746</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;row_key&#39;</span><span class="p">)</span>
<span class="go">{&#39;foo&#39;: 123456789, &#39;uuid&#39;: UUID(&#39;5880c4b8-bd1a-11df-bbe1-00234d21610a&#39;)}</span>
</pre></div>
</div>
<p>Of course, if <strong>pycassa</strong>&#8216;s automatic behavior isn&#8217;t working for you, you
can turn it off when you create the
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily" title="pycassa.columnfamily.ColumnFamily"><tt class="xref py py-class docutils literal"><span class="pre">ColumnFamily</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">col_fam</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Standard1&#39;</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">autopack_names</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">autopack_values</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>This mainly needs to be done when working with
<a class="reference internal" href="api/pycassa/columnfamilymap.html#pycassa.columnfamilymap.ColumnFamilyMap" title="pycassa.columnfamilymap.ColumnFamilyMap"><tt class="xref py py-class docutils literal"><span class="pre">ColumnFamilyMap</span></tt></a>.</p>
<div class="section" id="version-1-uuids-timeuuidtype">
<h3>Version 1 UUIDs (TimeUUIDType)<a class="headerlink" href="#version-1-uuids-timeuuidtype" title="Permalink to this headline">¶</a></h3>
<p>Version 1 UUIDs are <a class="reference external" href="http://www.riptano.com/docs/0.6/data_model/uuids">frequently used for timelines</a>
instead of timestamps.  Normally, this makes it difficult to get a slice of
columns for some time range or to create a column name or value for some
specific time.</p>
<p>To make this easier, if a <tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt> object or a timestamp with the
same precision as the output of <tt class="docutils literal"><span class="pre">time.time()</span></tt> is passed where a TimeUUID
is expected, <strong>pycassa</strong> will convert that into a UUID with an equivalent
timestamp component.</p>
<p>Suppose we have something like Twissandra&#8217;s public timeline but with TimeUUIDs
for column names. If we want to get all tweets that happened yesterday, we
can do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Userline&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">yesterday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tweets</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;__PUBLIC__&#39;</span><span class="p">,</span> <span class="n">column_start</span><span class="o">=</span><span class="n">yesterday</span><span class="p">,</span> <span class="n">column_finish</span><span class="o">=</span><span class="n">today</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, suppose there was a tweet that was supposed to be posted on December 11th
at 8:02:15, but it was dropped and now we need to put it in the public timeline.
There&#8217;s no need to generate a UUID, we can just pass another datetime object instead:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Userline&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;__PUBLIC__&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">time</span><span class="p">:</span> <span class="s">&#39;some tweet stuff here&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>One limitation of this is that you can&#8217;t ask for one specific column with a
TimeUUID name by passing a <tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt> through something like the <cite>columns</cite> parameter
for <tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt>; this is because there is no way to know the non-timestamp
components of the UUID ahead of time.  Instead, simply pass the same <tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt>
object for both <cite>column_start</cite> and <cite>column_finish</cite> and you&#8217;ll get one or more
columns for that exact moment in time.</p>
</div>
</div>
<div class="section" id="indexes">
<h2>Indexes<a class="headerlink" href="#indexes" title="Permalink to this headline">¶</a></h2>
<p>Cassandra 0.7.0 adds support for secondary indexes, which allow you to
efficiently get only rows which match a certain expression.</p>
<p>To use secondary indexes with Cassandra, you need to specify what columns
will be indexed.  In a <tt class="docutils literal"><span class="pre">cassandra.yaml</span></tt> file, this might look like:</p>
<div class="highlight-python"><pre>- name: Indexed1
  column_type: Standard
  column_metadata:
    - name: birthdate
      validator_class: LongType
      index_type: KEYS</pre>
</div>
<p>In order to use <a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily.get_indexed_slices" title="pycassa.columnfamily.ColumnFamily.get_indexed_slices"><tt class="xref py py-meth docutils literal"><span class="pre">get_indexed_slices()</span></tt></a>
to get data from Indexed1 using the indexed column, we need to create an
<a class="reference internal" href="api/pycassa/cassandra/ttypes.html#pycassa.cassandra.ttypes.IndexClause" title="pycassa.cassandra.ttypes.IndexClause"><tt class="xref py py-class docutils literal"><span class="pre">IndexClause</span></tt></a> which contains a list of
<a class="reference internal" href="api/pycassa/cassandra/ttypes.html#pycassa.cassandra.ttypes.IndexExpression" title="pycassa.cassandra.ttypes.IndexExpression"><tt class="xref py py-class docutils literal"><span class="pre">IndexExpression</span></tt></a> objects.  The module
<a class="reference internal" href="api/pycassa/index.html#module-pycassa.index" title="pycassa.index"><tt class="xref py py-mod docutils literal"><span class="pre">pycassa.index</span></tt></a> is designed to make this easier.</p>
<p>Suppose we are only interested in rows where &#8216;birthdate&#8217; is 1984. We might do
the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pycassa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pycassa.index</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;Keyspace1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Users&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">state_expr</span> <span class="o">=</span> <span class="n">create_index_expression</span><span class="p">(</span><span class="s">&#39;state&#39;</span><span class="p">,</span> <span class="s">&#39;Utah&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bday_expr</span> <span class="o">=</span> <span class="n">create_index_expression</span><span class="p">(</span><span class="s">&#39;birthdate&#39;</span><span class="p">,</span> <span class="mi">1970</span><span class="p">,</span> <span class="n">GT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clause</span> <span class="o">=</span> <span class="n">create_index_clause</span><span class="p">([</span><span class="n">state_expr</span><span class="p">,</span> <span class="n">bday_expr</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="o">.</span><span class="n">get_indexed_slices</span><span class="p">(</span><span class="n">clause</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">],</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;birthdate&#39;</span><span class="p">]</span>
<span class="go">John Smith, Utah 1971</span>
<span class="go">Mike Scott, Utah 1980</span>
<span class="go">Jeff Bird, Utah 1973</span>
</pre></div>
</div>
<p>Although at least one
<a class="reference internal" href="api/pycassa/cassandra/ttypes.html#pycassa.cassandra.ttypes.IndexExpression" title="pycassa.cassandra.ttypes.IndexExpression"><tt class="xref py py-class docutils literal"><span class="pre">IndexExpression</span></tt></a> in the clause
must be on an indexed column, you may also have other expressions which are
on non-indexed columns.</p>
</div>
<div class="section" id="connection-pooling">
<h2>Connection Pooling<a class="headerlink" href="#connection-pooling" title="Permalink to this headline">¶</a></h2>
<p>Pycassa uses connection pools to maintain connections to Cassandra servers.
The <a class="reference internal" href="api/pycassa/pool.html#pycassa.pool.ConnectionPool" title="pycassa.pool.ConnectionPool"><tt class="xref py py-class docutils literal"><span class="pre">ConnectionPool</span></tt></a> class is used to create the connection
pool.  After creating the pool, it may be used to create multiple
<a class="reference internal" href="api/pycassa/columnfamily.html#pycassa.columnfamily.ColumnFamily" title="pycassa.columnfamily.ColumnFamily"><tt class="xref py py-class docutils literal"><span class="pre">ColumnFamily</span></tt></a> objects.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="s">&#39;Keyspace1&#39;</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">standard_cf</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Standard1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">standard_cf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;col&#39;</span><span class="p">:</span> <span class="s">&#39;val&#39;</span><span class="p">})</span>
<span class="go">1354491238782746</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">super_cf</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Super1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">super_cf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;key2&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;col&#39;</span><span class="p">:</span> <span class="s">&#39;val&#39;</span><span class="p">})</span>
<span class="go">1354491239779182</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">standard_cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
<span class="go">{&#39;col&#39;: &#39;val&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
</pre></div>
</div>
<p>Automatic retries (or &#8220;failover&#8221;) happen by default with ConectionPools.
This means that if any operation fails, it will be transparently retried
on other servers until it succeeds or a maximum number of failures is reached.</p>
</div>
<div class="section" id="class-mapping-with-column-family-map">
<h2>Class Mapping with Column Family Map<a class="headerlink" href="#class-mapping-with-column-family-map" title="Permalink to this headline">¶</a></h2>
<p>You can map existing classes to column families using
<a class="reference internal" href="api/pycassa/columnfamilymap.html#pycassa.columnfamilymap.ColumnFamilyMap" title="pycassa.columnfamilymap.ColumnFamilyMap"><tt class="xref py py-class docutils literal"><span class="pre">ColumnFamilyMap</span></tt></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">string_column</span>       <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;Your Default&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">int_str_column</span>      <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">IntString</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">float_str_column</span>    <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">FloatString</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">float_column</span>        <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">Float64</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">datetime_str_column</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">DateTimeString</span><span class="p">()</span> <span class="c"># default=None</span>
</pre></div>
</div>
<p>The defaults will be filled in whenever you retrieve instances from the
Cassandra server and the column doesn&#8217;t exist. If you want to add a
column in the future, you can simply add the relevant attribute to the class
and the default value will be used when you get old instances.</p>
<p><a class="reference internal" href="api/pycassa/types.html#pycassa.types.IntString" title="pycassa.types.IntString"><tt class="xref py py-class docutils literal"><span class="pre">IntString</span></tt></a>, <a class="reference internal" href="api/pycassa/types.html#pycassa.types.FloatString" title="pycassa.types.FloatString"><tt class="xref py py-class docutils literal"><span class="pre">FloatString</span></tt></a>, and
<a class="reference internal" href="api/pycassa/types.html#pycassa.types.DateTimeString" title="pycassa.types.DateTimeString"><tt class="xref py py-class docutils literal"><span class="pre">DateTimeString</span></tt></a> all use string representations for
storage. <a class="reference internal" href="api/pycassa/types.html#pycassa.types.Float64" title="pycassa.types.Float64"><tt class="xref py py-class docutils literal"><span class="pre">Float64</span></tt></a> is stored as a double and is
native-endian. Be aware of any endian issues if you use it on different
architectures, or perhaps make your own column type.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="s">&#39;Keyspace1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cf</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Standard1&#39;</span><span class="p">,</span> <span class="n">autopack_names</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">autopack_values</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamilyMap</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span> <span class="n">cf</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As shown in the example, <cite>autopack_names</cite> and <cite>autopack_values</cite> should
be set to <tt class="xref docutils literal"><span class="pre">False</span></tt> when a ColumnFamily is used with a ColumnFamilyMap.</p>
</div>
<p>All the functions are exactly the same, except that they return
instances of the supplied class when possible.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Test</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#39;maptest&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">string_column</span> <span class="o">=</span> <span class="s">&#39;string test&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">int_str_column</span> <span class="o">=</span> <span class="mi">18</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">float_column</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">float_str_column</span> <span class="o">=</span> <span class="mf">35.8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">datetime_str_column</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">1261395560186855</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">string_column</span>
<span class="go">&#39;string test&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">int_str_column</span>
<span class="go">18</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">float_column</span>
<span class="go">35.799999999999997</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">datetime_str_column</span>
<span class="go">datetime.datetime(2009, 12, 23, 17, 6, 3)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">multiget</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">])</span>
<span class="go">{&#39;maptest&#39;: &lt;__main__.Test object at 0x7f8ddde0b9d0&gt;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_range</span><span class="p">())</span>
<span class="go">[&lt;__main__.Test object at 0x7f8ddde0b710&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_count</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
<span class="go">7</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">1261395603906864</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">cassandra.ttypes.NotFoundException</span>: <span class="n-Identifier">NotFoundException()</span>
</pre></div>
</div>
<p>You may also use a ColumnFamilyMap with super columns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamilyMap</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span> <span class="n">cf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Test</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#39;key1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">super_column</span> <span class="o">=</span> <span class="s">&#39;super1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">string_column</span> <span class="o">=</span> <span class="s">&#39;foobar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">int_str_column</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">float_column</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">float_str_column</span> <span class="o">=</span> <span class="mf">35.8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">datetime_str_column</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
<span class="go">{&#39;super1&#39;: &lt;__main__.Test object at 0x20ab350&gt;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Test</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">multiget</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">])</span>
<span class="go">{&#39;key1&#39;: {&#39;super1&#39;: &lt;__main__.Test object at 0x20ab550&gt;}}</span>
</pre></div>
</div>
</div>
<div class="section" id="keyspace-and-column-family-creation-and-alteration">
<h2>Keyspace and Column Family Creation and Alteration<a class="headerlink" href="#keyspace-and-column-family-creation-and-alteration" title="Permalink to this headline">¶</a></h2>
<p>Keyspaces and column families may be created, altered,
and dropped using <a class="reference internal" href="api/pycassa/system_manager.html#pycassa.system_manager.SystemManager" title="pycassa.system_manager.SystemManager"><tt class="xref py py-class docutils literal"><span class="pre">pycassa.system_manager.SystemManager</span></tt></a>. Additionally,
indexes may be created and dropped using this class as well.</p>
<p>Although most of SystemManager&#8217;s methods may be used in a program,
it is recommended that they be used manually with a tool like
<a class="reference internal" href="pycassa_shell.html#pycassa-shell"><em>pycassaShell</em></a>. There is a
<a class="reference internal" href="pycassa_shell.html#pycassa-shell-sys-man"><em>provided example</em></a> of this usage.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#connecting-to-cassandra">Connecting to Cassandra</a></li>
<li><a class="reference internal" href="#getting-a-columnfamily">Getting a ColumnFamily</a></li>
<li><a class="reference internal" href="#inserting-data">Inserting Data</a></li>
<li><a class="reference internal" href="#getting-data">Getting Data</a></li>
<li><a class="reference internal" href="#counting">Counting</a></li>
<li><a class="reference internal" href="#super-columns">Super Columns</a></li>
<li><a class="reference internal" href="#typed-column-names-and-values">Typed Column Names and Values</a><ul>
<li><a class="reference internal" href="#version-1-uuids-timeuuidtype">Version 1 UUIDs (TimeUUIDType)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indexes">Indexes</a></li>
<li><a class="reference internal" href="#connection-pooling">Connection Pooling</a></li>
<li><a class="reference internal" href="#class-mapping-with-column-family-map">Class Mapping with Column Family Map</a></li>
<li><a class="reference internal" href="#keyspace-and-column-family-creation-and-alteration">Keyspace and Column Family Creation and Alteration</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pycassa_shell.html"
                        title="next chapter">pycassaShell</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pycassa_shell.html" title="pycassaShell"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installing"
             >previous</a> |</li>
        <li><a href="index.html">pycassa v1.0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.3.
    </div>
  </body>
</html>