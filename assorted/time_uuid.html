

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Version 1 UUIDs (TimeUUIDType) &mdash; pycassa 1.7.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="pycassa 1.7.0 documentation" href="../index.html" />
    <link rel="up" title="Assorted Cassandra and pycassa Functionality" href="index.html" />
    <link rel="next" title="pycassaShell" href="pycassa_shell.html" />
    <link rel="prev" title="Class Mapping with Column Family Map" href="column_family_map.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pycassa_shell.html" title="pycassaShell"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="column_family_map.html" title="Class Mapping with Column Family Map"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">pycassa 1.7.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Assorted Cassandra and pycassa Functionality</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="version-1-uuids-timeuuidtype">
<h1>Version 1 UUIDs (TimeUUIDType)<a class="headerlink" href="#version-1-uuids-timeuuidtype" title="Permalink to this headline">Â¶</a></h1>
<p>Version 1 UUIDs are <a class="reference external" href="http://www.riptano.com/docs/0.8/data_model/uuids">frequently used for timelines</a>
instead of timestamps.  Normally, this makes it difficult to get a slice of
columns for some time range or to create a column name or value for some
specific time.</p>
<p>To make this easier, if a <tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt> object or a timestamp with the
same precision as the output of <tt class="docutils literal"><span class="pre">time.time()</span></tt> is passed where a TimeUUID
is expected, <strong>pycassa</strong> will convert that into a <tt class="xref py py-class docutils literal"><span class="pre">uuid.UUID</span></tt> with an equivalent
timestamp component.</p>
<p>Suppose we have something like Twissandra&#8217;s public timeline but with TimeUUIDs
for column names. If we want to get all tweets that happened yesterday, we
can do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Userline&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">yesterday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tweets</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;__PUBLIC__&#39;</span><span class="p">,</span> <span class="n">column_start</span><span class="o">=</span><span class="n">yesterday</span><span class="p">,</span> <span class="n">column_finish</span><span class="o">=</span><span class="n">today</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, suppose there was a tweet that was supposed to be posted on December 11th
at 8:02:15, but it was dropped and now we need to put it in the public timeline.
There&#8217;s no need to generate a UUID, we can just pass another datetime object instead:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span> <span class="o">=</span> <span class="n">pycassa</span><span class="o">.</span><span class="n">ColumnFamily</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="s">&#39;Userline&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;__PUBLIC__&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">time</span><span class="p">:</span> <span class="s">&#39;some tweet stuff here&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>One limitation of this is that you can&#8217;t ask for one specific column with a
TimeUUID name by passing a <tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt> through something like the <cite>columns</cite> parameter
for <tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt>; this is because there is no way to know the non-timestamp
components of the UUID ahead of time.  Instead, simply pass the same <tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt>
object for both <cite>column_start</cite> and <cite>column_finish</cite> and you&#8217;ll get one or more
columns for that exact moment in time.</p>
<p>Note that Python does not sort UUIDs the same way that Cassandra does. When Cassandra sorts V1
UUIDs it first compares the time component, and then the raw bytes of the UUID. Python on the
other hand just sorts the raw bytes. If you need to sort UUIDs in Python the same way Cassandra
does you will want to use something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">uuid</span><span class="o">,</span> <span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uuids</span> <span class="o">=</span> <span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">uuids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">improperly_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">uuids</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">properly_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">uuids</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">bytes</span><span class="p">))</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="column_family_map.html"
                        title="previous chapter">Class Mapping with Column Family Map</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pycassa_shell.html"
                        title="next chapter">pycassaShell</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/assorted/time_uuid.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pycassa_shell.html" title="pycassaShell"
             >next</a> |</li>
        <li class="right" >
          <a href="column_family_map.html" title="Class Mapping with Column Family Map"
             >previous</a> |</li>
        <li><a href="../index.html">pycassa 1.7.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Assorted Cassandra and pycassa Functionality</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>